@model IEnumerable<BezvizSystem.Web.Models.Mark.ViewMarkModel>

@{
    ViewBag.Title = "Отметка о прибытии";
}

<h2>Отметка о прибытии</h2>

@{ Html.RenderPartial("GroupData", Model); }


@section scripts
{
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>

    <script>
     
        function listCheckBoxes(elem) {
            if (elem)
                return elem.querySelectorAll('input[type=checkbox]')
        }

        function allCheckBoxesChecked(elem) {

            var list = listCheckBoxes(elem);

            for (var i = 0; i < list.length; i++) {
                if (!list[i].checked) {
                    return false;
                }
            }
            return true;
        }
   
        function onClickInfo (e) {

            var target = e.target;
            if (target.tagName == 'INPUT') {

                var divInfo = document.getElementById("visitorInfo");
                var allChecked = allCheckBoxesChecked(divInfo);

                var id = target.getAttribute("dataId");
                var value = target.checked;

                $.ajax({
                    url: '@Url.Action("Edit")?id=' + id + "&arrived=" + value
                });          
            }           
        };


        var mainTable = document.getElementById('mainTable');
       
        mainTable.onclick = function (e) {

            var data = mainTable.getElementsByTagName('tbody')[0]; 
         
            var target = e.target;
            if (target.tagName == "A") {

                var divInfo = document.getElementById("visitorInfo");
                if (divInfo) {
                    var td = divInfo.parentNode;
                    var tr = td.parentNode;
                    if (tr) data.removeChild(tr);
                }

                var tr = target.parentNode;
                while (tr.tagName != "TR") {
                    tr = tr.parentNode;
                    if (tr.tagName == "TABLE") break;
                }
                if (tr.tagName == "TR") {
                  
                    var newTr = document.createElement('tr');
                    var newTd = document.createElement('td');
                    var newDiv = document.createElement('div');

                    newTd.setAttribute("colspan", "8");
                    newDiv.setAttribute("id", "visitorInfo");

                    newTd.appendChild(newDiv);
                    newTr.appendChild(newTd);
                    data.insertBefore(newTr, tr.nextElementSibling);

                    newDiv.onclick = onClickInfo;

                    $.ajax({
                        url: '@Url.Action("ShowVisitors")?id=' + target.innerHTML,
                        dataType: "html",
                        success: function (data) {
                            $("#visitorInfo").html(data)
                        }
                    });
                }
            }
        }

    </script>
}



